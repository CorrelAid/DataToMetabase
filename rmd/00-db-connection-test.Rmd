---
title: "R Notebook"
---

```{r}
# install.packages("palmerpenguins")
library(tidyverse)
```

## Load Penguin Data (Local Copy)

```{r}
data_local_raw <- palmerpenguins::penguins
```

```{r}
head(data_local_raw)
```

## Example Aggergations

### Simple Group By / Count

```{r}
example_view_simple <- data_local_raw %>%
  group_by(island) %>%
  count()
```

### Faceting, a list of Group/Counts, Split by Island

```{r}
example_view_facets <- data_local_raw %>%
  group_by(island) %>%
  group_map(~ group_by(., species) %>% count())

example_view_facets
```

## Connect to DB

```{r}
# con <- DBI::dbConnect()
source(here::here("R", "00-connect-to-coolify.R"))
con # <- this is the currently open connection
```

### Get existing table names from DB

```{r}
(db_tables <- DBI::dbListTables(con))
```

### Write Local Copy of Pengunis Data to Remote DB

> ! only do so if table does not exist in remote DB !

```{r}
if (!"penguins" %in% db_tables) {
  print("Writing table `penguins` to DB")
  DBI::dbWriteTable(con, name = "penguins", value = data_local_raw)
} else {
  print("Skipping. table `penguins` already exists in DB")
}
```

### Read remote Penguins data from DB

```{r}
data_remote_raw <- DBI::dbReadTable(con, "penguins")

head(data_remote_raw)
```

### Compare local and remote data with `waldo`

```{r}
waldo::compare(data_local_raw, data_remote_raw)
```

## Important: Disconnect from DB

```{r}
DBI::dbDisconnect(con)
```
